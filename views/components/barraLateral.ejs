<!-- LATERAL DIREITA (SEMPRE PRESENTE) -->
<aside class="sidebar-right">
  <!-- Tarefas: Lista de tarefas rÃ¡pidas (DESIGN MELHORADO) -->
  <div class="tasks-section">
    <h3 class="section-title">
      <span>âœ…</span>
      Tarefas
    </h3>

    <!-- Caixa das tarefas com design melhorado -->
    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <span style="font-size: 14px; font-weight: 600; color: #333;">Pendentes</span>
        <span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">4</span>
      </div>

      <div style="display: grid; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f9fa'">
          <input type="checkbox" id="task1" style="margin: 0; cursor: pointer;" onchange="toggleTask(this)">
          <label for="task1" style="flex: 1; font-size: 13px; color: #333; cursor: pointer; margin: 0;">Revisar pedidos pendentes</label>
          <span style="color: #f59e0b; font-size: 11px;">ğŸ”¥ Urgente</span>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: #dcfce7; border-radius: 8px; opacity: 0.7;">
          <input type="checkbox" id="task2" checked style="margin: 0; cursor: pointer;" onchange="toggleTask(this)">
          <label for="task2" style="flex: 1; font-size: 13px; color: #333; cursor: pointer; margin: 0; text-decoration: line-through;">Sincronizar Mercado Livre</label>
          <span style="color: #16a34a; font-size: 11px;">âœ… Feito</span>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f9fa'">
          <input type="checkbox" id="task3" style="margin: 0; cursor: pointer;" onchange="toggleTask(this)">
          <label for="task3" style="flex: 1; font-size: 13px; color: #333; cursor: pointer; margin: 0;">Atualizar preÃ§os Shopee</label>
          <span style="color: #3b82f6; font-size: 11px;">ğŸ“… Hoje</span>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f9fa'">
          <input type="checkbox" id="task4" style="margin: 0; cursor: pointer;" onchange="toggleTask(this)">
          <label for="task4" style="flex: 1; font-size: 13px; color: #333; cursor: pointer; margin: 0;">Verificar estoque baixo</label>
          <span style="color: #f59e0b; font-size: 11px;">âš ï¸ Alerta</span>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f9fa'">
          <input type="checkbox" id="task5" style="margin: 0; cursor: pointer;" onchange="toggleTask(this)">
          <label for="task5" style="flex: 1; font-size: 13px; color: #333; cursor: pointer; margin: 0;">Enviar relatÃ³rio mensal</label>
          <span style="color: #8b5cf6; font-size: 11px;">ğŸ“Š RelatÃ³rio</span>
        </div>
      </div>

      <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; display: grid; gap: 8px;">
        <button onclick="adicionarTarefa()" style="width: 100%; padding: 8px; background: #f8f9fa; border: 1px dashed #ccc; border-radius: 6px; color: #666; font-size: 12px; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f9fa'">
          + Adicionar tarefa
        </button>
        <button onclick="verTodasTarefas()" style="width: 100%; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
          ğŸ“‹ Ver todas
        </button>
      </div>
    </div>
  </div>

  <!-- CalendÃ¡rio: Pequeno calendÃ¡rio mensal -->
  <div class="calendar-section">
    <h3 class="section-title">
      <span>ğŸ“…</span>
      CalendÃ¡rio
    </h3>

    <div class="mini-calendar">
      <div class="calendar-header" id="currentMonth">
        Janeiro 2024
      </div>

      <div class="calendar-grid" id="calendarGrid">
        <!-- CabeÃ§alho dos dias -->
        <div style="font-weight: bold; color: #666; text-align: center;">D</div>
        <div style="font-weight: bold; color: #666; text-align: center;">S</div>
        <div style="font-weight: bold; color: #666; text-align: center;">T</div>
        <div style="font-weight: bold; color: #666; text-align: center;">Q</div>
        <div style="font-weight: bold; color: #666; text-align: center;">Q</div>
        <div style="font-weight: bold; color: #666; text-align: center;">S</div>
        <div style="font-weight: bold; color: #666; text-align: center;">S</div>

        <!-- Dias do mÃªs serÃ£o inseridos aqui via JavaScript -->
      </div>
    </div>
  </div>

  <!-- BotÃ£o "Pergunte para IA" -->
  <div class="ai-section">
    <h3 class="section-title">
      <span>ğŸ¤–</span>
      Assistente IA
    </h3>

    <button class="ai-button" onclick="perguntarIA()">
      Pergunte para IA
    </button>

    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #666;">
      <strong>ğŸ’¡ Dica do dia:</strong><br>
      <span id="aiTip">Considere reabastecer o estoque de Kit PCR COVID-19. Vendas aumentaram 15% esta semana.</span>
    </div>
  </div>
</aside>

<script>
  // Gerar calendÃ¡rio (CORRIGIDO)
  function generateCalendar() {
    const now = new Date();
    const currentMonth = now.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
    document.getElementById('currentMonth').textContent = currentMonth.charAt(0).toUpperCase() + currentMonth.slice(1);

    const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
    const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);

    // Calcular o primeiro dia da semana a ser mostrado
    const startDate = new Date(firstDay);
    const dayOfWeek = firstDay.getDay(); // 0 = domingo, 1 = segunda, etc.
    startDate.setDate(firstDay.getDate() - dayOfWeek);

    const calendarGrid = document.getElementById('calendarGrid');
    if (!calendarGrid) return;

    // Remover apenas os dias, mantendo o cabeÃ§alho
    const dayElements = calendarGrid.querySelectorAll('.calendar-day');
    dayElements.forEach(el => el.remove());

    // Gerar 42 dias (6 semanas x 7 dias)
    for (let i = 0; i < 42; i++) {
      const currentDate = new Date(startDate);
      currentDate.setDate(startDate.getDate() + i);

      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      dayElement.textContent = currentDate.getDate();
      dayElement.style.textAlign = 'center';
      dayElement.style.cursor = 'pointer';

      // Verificar se Ã© do mÃªs atual
      if (currentDate.getMonth() === now.getMonth() && currentDate.getFullYear() === now.getFullYear()) {
        // Verificar se Ã© hoje
        if (currentDate.getDate() === now.getDate()) {
          dayElement.classList.add('today');
        }
        dayElement.style.color = '#333';
      } else {
        // Dias de outros meses ficam mais claros
        dayElement.style.opacity = '0.4';
        dayElement.style.color = '#999';
      }

      calendarGrid.appendChild(dayElement);
    }
  }

  // FunÃ§Ã£o para perguntar Ã  IA
  function perguntarIA() {
    abrirChatIA();
  }

  // ===== CHAT IA FUNCIONAL =====
  function abrirChatIA() {
    // Criar modal de chat
    const modal = document.createElement('div');
    modal.id = 'modalChatIA';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;

    modal.innerHTML = `
      <div style="background: white; border-radius: 12px; width: 90%; max-width: 500px; height: 600px; display: flex; flex-direction: column;">
        <!-- Header do Chat -->
        <div style="padding: 20px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #3b82f6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">ğŸ¤–</div>
            <div>
              <h3 style="margin: 0; color: #333;">IA PCR Labor</h3>
              <p style="margin: 0; color: #666; font-size: 12px;">Assistente Inteligente</p>
            </div>
          </div>
          <button onclick="fecharChatIA()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>

        <!-- Ãrea de mensagens -->
        <div id="chatMessages" style="flex: 1; padding: 20px; overflow-y: auto; background: #f8f9fa;">
          <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #8b5cf6, #3b82f6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; flex-shrink: 0;">ğŸ¤–</div>
            <div style="background: white; padding: 12px 16px; border-radius: 12px; border-top-left-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 80%;">
              <p style="margin: 0; color: #333; font-size: 14px;">OlÃ¡! Sou a IA do PCR Labor. Como posso ajudar vocÃª hoje? Posso responder sobre vendas, estoque, relatÃ³rios e muito mais!</p>
            </div>
          </div>
        </div>

        <!-- Input de mensagem -->
        <div style="padding: 20px; border-top: 1px solid #e0e0e0;">
          <div style="display: flex; gap: 12px;">
            <input type="text" id="chatInput" placeholder="Digite sua pergunta..."
                   style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                   onkeypress="if(event.key==='Enter') enviarMensagem()">
            <button onclick="enviarMensagem()"
                    style="padding: 12px 20px; background: #8b5cf6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
              Enviar
            </button>
          </div>

          <!-- SugestÃµes rÃ¡pidas -->
          <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button onclick="perguntaRapida('Como estÃ£o as vendas hoje?')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 16px; font-size: 12px; cursor: pointer;">ğŸ“Š Vendas hoje</button>
            <button onclick="perguntaRapida('Quais produtos estÃ£o com estoque baixo?')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 16px; font-size: 12px; cursor: pointer;">ğŸ“¦ Estoque baixo</button>
            <button onclick="perguntaRapida('Gerar relatÃ³rio de vendas')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 16px; font-size: 12px; cursor: pointer;">ğŸ“„ RelatÃ³rio</button>
          </div>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
    document.getElementById('chatInput').focus();
  }

  function fecharChatIA() {
    const modal = document.getElementById('modalChatIA');
    if (modal) {
      modal.remove();
    }
  }

  function perguntaRapida(pergunta) {
    document.getElementById('chatInput').value = pergunta;
    enviarMensagem();
  }

  function enviarMensagem() {
    const input = document.getElementById('chatInput');
    const mensagem = input.value.trim();

    if (!mensagem) return;

    // Adicionar mensagem do usuÃ¡rio
    adicionarMensagem(mensagem, 'usuario');
    input.value = '';

    // Simular "digitando..."
    setTimeout(() => {
      adicionarMensagem('digitando...', 'ia', true);

      // Resposta da IA apÃ³s 2 segundos
      setTimeout(() => {
        removerDigitando();
        const resposta = gerarRespostaIA(mensagem);
        adicionarMensagem(resposta, 'ia');
      }, 2000);
    }, 500);
  }

  function adicionarMensagem(texto, tipo, digitando = false) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');

    if (tipo === 'usuario') {
      messageDiv.innerHTML = `
        <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
          <div style="background: #8b5cf6; color: white; padding: 12px 16px; border-radius: 12px; border-top-right-radius: 4px; max-width: 80%;">
            <p style="margin: 0; font-size: 14px;">${texto}</p>
          </div>
        </div>
      `;
    } else {
      messageDiv.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px;" ${digitando ? 'id="digitandoMsg"' : ''}>
          <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #8b5cf6, #3b82f6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; flex-shrink: 0;">ğŸ¤–</div>
          <div style="background: white; padding: 12px 16px; border-radius: 12px; border-top-left-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 80%;">
            <p style="margin: 0; color: #333; font-size: 14px; ${digitando ? 'font-style: italic; opacity: 0.7;' : ''}">${texto}</p>
          </div>
        </div>
      `;
    }

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function removerDigitando() {
    const digitandoMsg = document.getElementById('digitandoMsg');
    if (digitandoMsg) {
      digitandoMsg.remove();
    }
  }

  function gerarRespostaIA(pergunta) {
    const perguntaLower = pergunta.toLowerCase();

    // Respostas baseadas em palavras-chave
    if (perguntaLower.includes('venda') || perguntaLower.includes('vendas')) {
      return `ğŸ“Š **AnÃ¡lise de Vendas:**\n\nâ€¢ Total hoje: R$ 2.450,00\nâ€¢ Crescimento: +15% vs ontem\nâ€¢ Melhor produto: Kit PCR COVID-19\nâ€¢ Plataforma lÃ­der: Mercado Livre (60%)\n\nRecomendo focar na promoÃ§Ã£o dos kits de Hepatite B que estÃ£o com baixa rotatividade.`;
    }

    if (perguntaLower.includes('estoque')) {
      return `ğŸ“¦ **Status do Estoque:**\n\nâš ï¸ **Produtos com estoque baixo:**\nâ€¢ Kit PCR Dengue: 5 unidades\nâ€¢ Kit PCR Zika: 8 unidades\n\nâœ… **Estoque adequado:**\nâ€¢ Kit PCR COVID-19: 150 unidades\nâ€¢ Kit PCR Influenza: 200 unidades\n\nSugestÃ£o: Reabastecer os produtos em alerta.`;
    }

    if (perguntaLower.includes('relatÃ³rio') || perguntaLower.includes('relatorio')) {
      return `ğŸ“„ **RelatÃ³rios DisponÃ­veis:**\n\n1. **Vendas Mensais** - AnÃ¡lise completa\n2. **Estoque Atual** - Status detalhado\n3. **Performance por Plataforma**\n4. **Produtos Mais Vendidos**\n\nPosso gerar qualquer um desses relatÃ³rios. Qual vocÃª gostaria?`;
    }

    if (perguntaLower.includes('plataforma')) {
      return `ğŸ›’ **Performance das Plataformas:**\n\nâ€¢ **Mercado Livre**: R$ 15.200 (60%)\nâ€¢ **Shopee**: R$ 8.500 (33%)\nâ€¢ **PCR Labor Direto**: R$ 1.800 (7%)\n\nO Mercado Livre estÃ¡ performando muito bem! Considere aumentar o investimento em anÃºncios lÃ¡.`;
    }

    if (perguntaLower.includes('produto') || perguntaLower.includes('produtos')) {
      return `ğŸ“¦ **AnÃ¡lise de Produtos:**\n\nğŸ† **Top 3 Mais Vendidos:**\n1. Kit PCR COVID-19 (45 vendas)\n2. Kit PCR Influenza (32 vendas)\n3. Kit PCR Hepatite B (18 vendas)\n\nğŸ’¡ **Oportunidade:** Kit PCR Zika tem baixa rotatividade. Que tal uma promoÃ§Ã£o?`;
    }

    // Respostas genÃ©ricas inteligentes
    const respostasGenericas = [
      `ğŸ¤– Entendi sua pergunta sobre "${pergunta}". Com base nos dados atuais:\n\nâ€¢ Suas vendas estÃ£o 12% acima da mÃ©dia\nâ€¢ Estoque geral estÃ¡ adequado\nâ€¢ Recomendo focar no Mercado Livre\n\nPrecisa de mais detalhes sobre algum aspecto especÃ­fico?`,

      `ğŸ“Š Analisando "${pergunta}"...\n\nâ€¢ Performance geral: Excelente\nâ€¢ TendÃªncia: Crescimento sustentÃ¡vel\nâ€¢ PrÃ³ximos passos: Expandir produtos de alta rotatividade\n\nQuer que eu detalhe alguma mÃ©trica especÃ­fica?`,

      `ğŸ’¡ Sobre "${pergunta}", posso ajudar!\n\nâ€¢ Dados atualizados em tempo real\nâ€¢ AnÃ¡lise preditiva disponÃ­vel\nâ€¢ SugestÃµes personalizadas prontas\n\nQual aspecto vocÃª gostaria de explorar mais?`
    ];

    return respostasGenericas[Math.floor(Math.random() * respostasGenericas.length)];
  }

  // FunÃ§Ã£o para toggle de tarefas (NOVA)
  function toggleTask(checkbox) {
    const label = checkbox.nextElementSibling;
    const container = checkbox.parentElement;

    if (checkbox.checked) {
      label.style.textDecoration = 'line-through';
      container.style.background = '#dcfce7';
      container.style.opacity = '0.7';

      // Atualizar contador
      const counter = document.querySelector('[style*="background: #f59e0b"]');
      const currentCount = parseInt(counter.textContent);
      counter.textContent = Math.max(0, currentCount - 1);

      // Feedback visual
      setTimeout(() => {
        alert('âœ… Tarefa concluÃ­da!\n\nParabÃ©ns por manter a produtividade!');
      }, 100);
    } else {
      label.style.textDecoration = 'none';
      container.style.background = '#f8f9fa';
      container.style.opacity = '1';

      // Atualizar contador
      const counter = document.querySelector('[style*="background: #f59e0b"]');
      const currentCount = parseInt(counter.textContent);
      counter.textContent = currentCount + 1;
    }
  }

  // ===== SISTEMA DE TAREFAS DEFINITIVO =====
  // Armazenamento global de tarefas
  if (!window.tarefasGlobais) {
    window.tarefasGlobais = [
      { id: 1, texto: 'Revisar pedidos pendentes', prioridade: 'urgente', concluida: false },
      { id: 2, texto: 'Sincronizar Mercado Livre', prioridade: 'normal', concluida: true },
      { id: 3, texto: 'Atualizar preÃ§os Shopee', prioridade: 'normal', concluida: false },
      { id: 4, texto: 'Verificar estoque baixo', prioridade: 'alta', concluida: false },
      { id: 5, texto: 'Enviar relatÃ³rio mensal', prioridade: 'baixa', concluida: false }
    ];
  }

  let tarefas = window.tarefasGlobais;

  // FunÃ§Ã£o para atualizar a exibiÃ§Ã£o das tarefas na barra lateral
  function atualizarExibicaoTarefas() {
    const tarefasPendentes = tarefas.filter(t => !t.concluida);

    // Seletor mais especÃ­fico para evitar conflitos com grÃ¡ficos
    const containerTarefas = document.querySelector('.sidebar .content-section:first-child .section-content');

    if (containerTarefas) {
      // Limpar tarefas existentes
      const tarefasExistentes = containerTarefas.querySelectorAll('[data-tarefa-id]');
      tarefasExistentes.forEach(t => t.remove());

      // Adicionar tarefas pendentes (mÃ¡ximo 3 na barra lateral)
      tarefasPendentes.slice(0, 3).forEach(tarefa => {
        const tarefaElement = document.createElement('div');
        tarefaElement.setAttribute('data-tarefa-id', tarefa.id);
        tarefaElement.style.cssText = `
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 8px;
          background: #f8f9fa;
          border-radius: 6px;
          margin-bottom: 8px;
          border-left: 3px solid ${getPrioridadeCor(tarefa.prioridade)};
        `;

        tarefaElement.innerHTML = `
          <input type="checkbox" onchange="marcarTarefaConcluida(${tarefa.id}, this)" style="margin: 0; cursor: pointer;">
          <span style="flex: 1; font-size: 12px; color: #333;">${tarefa.texto}</span>
          <span style="font-size: 10px; color: #666;">${getPrioridadeTexto(tarefa.prioridade).split(' ')[0]}</span>
        `;

        // Inserir antes dos botÃµes de tarefas
        const botoesTarefas = containerTarefas.querySelector('[style*="border-top"][style*="gap: 8px"]');
        if (botoesTarefas) {
          containerTarefas.insertBefore(tarefaElement, botoesTarefas);
        } else {
          containerTarefas.appendChild(tarefaElement);
        }
      });
    }

    atualizarContadorTarefas();
  }

  function marcarTarefaConcluida(id, checkbox) {
    const tarefa = window.tarefasGlobais.find(t => t.id === id);
    if (tarefa) {
      tarefa.concluida = checkbox.checked;
      tarefas = window.tarefasGlobais; // Sincronizar

      // Feedback visual
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: #16a34a;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 1000;
        font-size: 14px;
      `;
      toast.textContent = checkbox.checked ? 'âœ… Tarefa concluÃ­da!' : 'ğŸ”„ Tarefa reativada!';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);

      // Atualizar exibiÃ§Ã£o
      setTimeout(() => {
        atualizarExibicaoTarefas();
      }, 500);
    }
  }

  function adicionarTarefa() {
    abrirModalTarefa();
  }

  function abrirModalTarefa(editarId = null) {
    const tarefa = editarId ? tarefas.find(t => t.id === editarId) : null;
    const titulo = editarId ? 'Editar Tarefa' : 'Nova Tarefa';

    const modal = document.createElement('div');
    modal.id = 'modalTarefa';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;

    modal.innerHTML = `
      <div style="background: white; border-radius: 12px; padding: 25px; width: 95%; max-width: 500px; max-height: 85vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #333; font-size: 18px;">ğŸ“ ${titulo}</h2>
          <button onclick="fecharModalTarefa()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>

        <form id="formTarefa" onsubmit="salvarTarefa(event, ${editarId})">
          <div style="display: grid; gap: 20px;">

            <!-- DescriÃ§Ã£o -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">ğŸ“ DescriÃ§Ã£o da Tarefa</label>
              <textarea id="descricaoTarefa" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; min-height: 80px; resize: vertical;" placeholder="Ex: Revisar pedidos pendentes de aprovaÃ§Ã£o...">${tarefa ? tarefa.texto : ''}</textarea>
            </div>

            <!-- Prioridade -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">âš¡ Prioridade</label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; ${tarefa?.prioridade === 'baixa' ? 'border-color: #16a34a; background: #f0fff4;' : ''}" onclick="selecionarPrioridade('baixa')">
                  <input type="radio" name="prioridade" value="baixa" ${tarefa?.prioridade === 'baixa' ? 'checked' : ''} style="margin: 0;">
                  <span>ğŸŸ¢ Baixa</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; ${tarefa?.prioridade === 'normal' ? 'border-color: #3b82f6; background: #f0f8ff;' : ''}" onclick="selecionarPrioridade('normal')">
                  <input type="radio" name="prioridade" value="normal" ${tarefa?.prioridade === 'normal' || !tarefa ? 'checked' : ''} style="margin: 0;">
                  <span>ğŸ”µ Normal</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; ${tarefa?.prioridade === 'alta' ? 'border-color: #f59e0b; background: #fff8e1;' : ''}" onclick="selecionarPrioridade('alta')">
                  <input type="radio" name="prioridade" value="alta" ${tarefa?.prioridade === 'alta' ? 'checked' : ''} style="margin: 0;">
                  <span>ğŸŸ¡ Alta</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; ${tarefa?.prioridade === 'urgente' ? 'border-color: #ef4444; background: #fef2f2;' : ''}" onclick="selecionarPrioridade('urgente')">
                  <input type="radio" name="prioridade" value="urgente" ${tarefa?.prioridade === 'urgente' ? 'checked' : ''} style="margin: 0;">
                  <span>ğŸ”´ Urgente</span>
                </label>
              </div>
            </div>

            <!-- Data de vencimento -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">ğŸ“… Data de Vencimento (Opcional)</label>
              <input type="date" id="dataVencimento" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
            </div>

            <!-- Categoria -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">ğŸ·ï¸ Categoria</label>
              <select id="categoriaTarefa" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                <option value="geral">ğŸ“‹ Geral</option>
                <option value="vendas">ğŸ’° Vendas</option>
                <option value="estoque">ğŸ“¦ Estoque</option>
                <option value="pedidos">ğŸ“‹ Pedidos</option>
                <option value="plataformas">ğŸ›’ Plataformas</option>
                <option value="financeiro">ğŸ’³ Financeiro</option>
                <option value="administrativo">ğŸ¢ Administrativo</option>
              </select>
            </div>

          </div>

          <div style="display: flex; gap: 15px; margin-top: 25px;">
            <button type="button" onclick="fecharModalTarefa()" style="flex: 1; padding: 12px; background: #6b7280; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
              Cancelar
            </button>
            <button type="submit" style="flex: 1; padding: 12px; background: #018820; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
              ${editarId ? 'âœ… Salvar' : 'ğŸ“ Criar Tarefa'}
            </button>
          </div>
        </form>
      </div>
    `;

    document.body.appendChild(modal);
    document.getElementById('descricaoTarefa').focus();
  }

  function fecharModalTarefa() {
    const modal = document.getElementById('modalTarefa');
    if (modal) modal.remove();
  }

  function selecionarPrioridade(prioridade) {
    const radios = document.querySelectorAll('input[name="prioridade"]');
    const labels = document.querySelectorAll('label[onclick*="selecionarPrioridade"]');

    radios.forEach(radio => radio.checked = radio.value === prioridade);

    labels.forEach(label => {
      label.style.borderColor = '#e0e0e0';
      label.style.background = 'white';
    });

    const cores = {
      'baixa': { border: '#16a34a', bg: '#f0fff4' },
      'normal': { border: '#3b82f6', bg: '#f0f8ff' },
      'alta': { border: '#f59e0b', bg: '#fff8e1' },
      'urgente': { border: '#ef4444', bg: '#fef2f2' }
    };

    const labelSelecionada = document.querySelector(`label[onclick="selecionarPrioridade('${prioridade}')"]`);
    if (labelSelecionada && cores[prioridade]) {
      labelSelecionada.style.borderColor = cores[prioridade].border;
      labelSelecionada.style.background = cores[prioridade].bg;
    }
  }

  function salvarTarefa(event, editarId) {
    event.preventDefault();

    const descricao = document.getElementById('descricaoTarefa').value.trim();
    const prioridade = document.querySelector('input[name="prioridade"]:checked').value;
    const dataVencimento = document.getElementById('dataVencimento').value;
    const categoria = document.getElementById('categoriaTarefa').value;

    if (!descricao) {
      alert('âŒ Por favor, digite a descriÃ§Ã£o da tarefa.');
      return;
    }

    if (editarId) {
      // Editar tarefa existente
      const tarefa = window.tarefasGlobais.find(t => t.id === editarId);
      if (tarefa) {
        tarefa.texto = descricao;
        tarefa.prioridade = prioridade;
        tarefa.dataVencimento = dataVencimento;
        tarefa.categoria = categoria;
      }
      alert('âœ… Tarefa editada com sucesso!');
    } else {
      // Criar nova tarefa
      const novaTarefa = {
        id: Date.now(),
        texto: descricao,
        prioridade,
        dataVencimento,
        categoria,
        concluida: false,
        criadaEm: new Date()
      };
      window.tarefasGlobais.push(novaTarefa);
      alert('âœ… Tarefa criada com sucesso!');
    }

    // Sincronizar variÃ¡vel local
    tarefas = window.tarefasGlobais;

    fecharModalTarefa();
    atualizarExibicaoTarefas(); // Atualizar barra lateral
  }

  function atualizarContadorTarefas() {
    const tarefasPendentes = tarefas.filter(t => !t.concluida).length;
    const counter = document.querySelector('[style*="background: #f59e0b"]');
    if (counter) {
      counter.textContent = tarefasPendentes;
    }
  }

  // FunÃ§Ã£o para ver todas as tarefas
  function verTodasTarefas() {
    abrirModalListaTarefas();
  }

  function abrirModalListaTarefas() {
    const modal = document.createElement('div');
    modal.id = 'modalListaTarefas';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;

    const tarefasPendentes = tarefas.filter(t => !t.concluida);
    const tarefasConcluidas = tarefas.filter(t => t.concluida);

    modal.innerHTML = `
      <div style="background: white; border-radius: 12px; padding: 25px; width: 95%; max-width: 700px; max-height: 85vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #333; font-size: 18px;">ğŸ“‹ Todas as Tarefas</h2>
          <button onclick="fecharModalListaTarefas()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>

        <!-- EstatÃ­sticas -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
          <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px; border-left: 4px solid #16a34a;">
            <div style="font-size: 24px; font-weight: bold; color: #16a34a;">${tarefasConcluidas.length}</div>
            <div style="font-size: 12px; color: #666;">ConcluÃ­das</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #f59e0b;">
            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${tarefasPendentes.length}</div>
            <div style="font-size: 12px; color: #666;">Pendentes</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
            <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">${tarefas.length}</div>
            <div style="font-size: 12px; color: #666;">Total</div>
          </div>
        </div>

        <!-- Tarefas Pendentes -->
        <div style="margin-bottom: 25px;">
          <h3 style="margin: 0 0 15px; color: #333; font-size: 16px;">â³ Pendentes (${tarefasPendentes.length})</h3>
          <div style="display: grid; gap: 10px;">
            ${tarefasPendentes.map(tarefa => `
              <div style="display: flex; align-items: center; gap: 12px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${getPrioridadeCor(tarefa.prioridade)};">
                <input type="checkbox" onchange="toggleTarefaModal(${tarefa.id}, this)" style="margin: 0; cursor: pointer;">
                <div style="flex: 1;">
                  <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${tarefa.texto}</div>
                  <div style="display: flex; gap: 10px; font-size: 12px; color: #666;">
                    <span>${getPrioridadeTexto(tarefa.prioridade)}</span>
                    ${tarefa.categoria ? `<span>â€¢ ${getCategoriaTexto(tarefa.categoria)}</span>` : ''}
                    ${tarefa.dataVencimento ? `<span>â€¢ ğŸ“… ${new Date(tarefa.dataVencimento).toLocaleDateString('pt-BR')}</span>` : ''}
                  </div>
                </div>
                <button onclick="abrirModalTarefa(${tarefa.id})" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">âœï¸ Editar</button>
                <button onclick="excluirTarefa(${tarefa.id})" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">ğŸ—‘ï¸</button>
              </div>
            `).join('')}
            ${tarefasPendentes.length === 0 ? '<div style="text-align: center; padding: 20px; color: #666;">ğŸ‰ Nenhuma tarefa pendente!</div>' : ''}
          </div>
        </div>

        <!-- Tarefas ConcluÃ­das -->
        <div>
          <h3 style="margin: 0 0 15px; color: #333; font-size: 16px;">âœ… ConcluÃ­das (${tarefasConcluidas.length})</h3>
          <div style="display: grid; gap: 10px;">
            ${tarefasConcluidas.map(tarefa => `
              <div style="display: flex; align-items: center; gap: 12px; padding: 15px; background: #dcfce7; border-radius: 8px; opacity: 0.7;">
                <input type="checkbox" checked onchange="toggleTarefaModal(${tarefa.id}, this)" style="margin: 0; cursor: pointer;">
                <div style="flex: 1;">
                  <div style="font-weight: 600; color: #333; margin-bottom: 4px; text-decoration: line-through;">${tarefa.texto}</div>
                  <div style="display: flex; gap: 10px; font-size: 12px; color: #666;">
                    <span>${getPrioridadeTexto(tarefa.prioridade)}</span>
                    ${tarefa.categoria ? `<span>â€¢ ${getCategoriaTexto(tarefa.categoria)}</span>` : ''}
                  </div>
                </div>
                <button onclick="excluirTarefa(${tarefa.id})" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">ğŸ—‘ï¸</button>
              </div>
            `).join('')}
            ${tarefasConcluidas.length === 0 ? '<div style="text-align: center; padding: 20px; color: #666;">Nenhuma tarefa concluÃ­da ainda.</div>' : ''}
          </div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 25px;">
          <button onclick="fecharModalListaTarefas()" style="flex: 1; padding: 12px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer;">
            Fechar
          </button>
          <button onclick="fecharModalListaTarefas(); abrirModalTarefa();" style="flex: 1; padding: 12px; background: #018820; color: white; border: none; border-radius: 8px; cursor: pointer;">
            ğŸ“ Nova Tarefa
          </button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
  }

  function fecharModalListaTarefas() {
    const modal = document.getElementById('modalListaTarefas');
    if (modal) modal.remove();
  }

  function toggleTarefaModal(id, checkbox) {
    const tarefa = tarefas.find(t => t.id === id);
    if (tarefa) {
      tarefa.concluida = checkbox.checked;
      atualizarContadorTarefas();

      // Reabrir modal para atualizar a lista
      setTimeout(() => {
        fecharModalListaTarefas();
        abrirModalListaTarefas();
      }, 100);
    }
  }

  function excluirTarefa(id) {
    if (confirm('ğŸ—‘ï¸ Tem certeza que deseja excluir esta tarefa?')) {
      window.tarefasGlobais = window.tarefasGlobais.filter(t => t.id !== id);
      tarefas = window.tarefasGlobais; // Sincronizar
      atualizarExibicaoTarefas(); // Atualizar barra lateral

      // Reabrir modal para atualizar a lista
      setTimeout(() => {
        fecharModalListaTarefas();
        abrirModalListaTarefas();
      }, 100);
    }
  }

  function getPrioridadeCor(prioridade) {
    const cores = {
      'baixa': '#16a34a',
      'normal': '#3b82f6',
      'alta': '#f59e0b',
      'urgente': '#ef4444'
    };
    return cores[prioridade] || '#6b7280';
  }

  function getPrioridadeTexto(prioridade) {
    const textos = {
      'baixa': 'ğŸŸ¢ Baixa',
      'normal': 'ğŸ”µ Normal',
      'alta': 'ğŸŸ¡ Alta',
      'urgente': 'ğŸ”´ Urgente'
    };
    return textos[prioridade] || 'ğŸ”µ Normal';
  }

  function getCategoriaTexto(categoria) {
    const textos = {
      'geral': 'ğŸ“‹ Geral',
      'vendas': 'ğŸ’° Vendas',
      'estoque': 'ğŸ“¦ Estoque',
      'pedidos': 'ğŸ“‹ Pedidos',
      'plataformas': 'ğŸ›’ Plataformas',
      'financeiro': 'ğŸ’³ Financeiro',
      'administrativo': 'ğŸ¢ Administrativo'
    };
    return textos[categoria] || 'ğŸ“‹ Geral';
  }

  // Inicializar calendÃ¡rio e tarefas quando a pÃ¡gina carregar
  document.addEventListener('DOMContentLoaded', function() {
    generateCalendar();
    setTimeout(() => {
      atualizarExibicaoTarefas();
    }, 500);
  });
</script>
